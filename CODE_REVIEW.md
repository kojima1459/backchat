# コードレビューレポート (しれっとToDo Chat)

## はじめに

「しれっとToDo Chat」のコードベース全体を、以下の5つの観点から厳密にレビューしました。
1.  **設計**（責務分離、関数の凝集度、依存関係）
2.  **例外処理・エラーハンドリング**
3.  **セキュリティ**（入力検証、認証、脆弱性）
4.  **パフォーマンス**
5.  **保守性**（拡張性、命名、コメント、テストの有無）

各問題点に対して、改善理由、優先度（S/A/B/C）、および修正方針を提示します。

---

## レビュー結果一覧

### 優先度 S (即時修正を推奨)

| No. | ファイル | 問題点 | 改善理由 | 修正方針 |
| :-- | :--- | :--- | :--- | :--- |
| S-1 | `src/App.tsx` | **巨大コンポーネント化 (God Component)** | UI状態、ビジネスロジック、データ取得が単一ファイルに集中。可読性・テスト性・保守性が著しく低い。 | 状態管理ロジックをカスタムフックに分離 (`useModalManager`, `useRoomManager`)。UIを責務ごとに子コンポーネントへ分割。 |

### 優先度 A (重要な改善項目)

| No. | ファイル | 問題点 | 改善理由 | 修正方針 |
| :-- | :--- | :--- | :--- | :--- |
| A-1 | `src/services/firebase.ts` | **Firebase設定のハードコード** | APIキー等がコードに直接埋め込まれている。環境ごとの設定切り替えができず、セキュリティリスクも高い。 | Viteの環境変数機能 (`.env`ファイル) を利用し、`import.meta.env` から設定を読み込むように変更。 |
| A-2 | `src/hooks/useTodos.ts` | **localStorageの例外処理欠如** | `localStorage`はストレージ容量超過やプライベートモード時に例外をスローする可能性があるが、`try...catch`がない。 | `getItem`, `setItem` を `try...catch` で囲み、エラー発生時はコンソールに警告を出し、デフォルトの空配列を返す。 |
| A-3 | `src/App.tsx` | **過度なProp Drilling** | `uid`や`isOnline`などの状態が、多くのコンポーネントを経由してバケツリレーされている。 | `AuthContext`で認証状態だけでなく、オンライン状態も提供するように拡張し、各コンポーネントが必要な値を直接Contextから取得する。 |

### 優先度 B (対応が望ましい改善)

| No. | ファイル | 問題点 | 改善理由 | 修正方針 |
| :-- | :--- | :--- | :--- | :--- |
| B-1 | `src/components/JoinRoomModal.tsx` | **クライアントサイドのみの連続試行対策** | Join試行の5秒クールダウンがクライアント側のみの実装。容易に回避可能。 | **[修正方針]** Firestore Rulesでは時間ベースの制御は困難なため、MVPでは許容。ただし、Cloud Functionsを導入する本格運用では、IPベースのレートリミットを実装すべきと明記。 |
| B-2 | `src/services/room.ts` | **エラーメッセージのハードコード** | `joinRoom`関数内に「満員です」などのユーザー向けエラーメッセージが直接記述されている。 | エラー種別（例: `room_full`, `room_deleted`）を返し、UI層でメッセージに変換する。国際化対応やメッセージの一元管理が容易になる。 |
| B-3 | `src/App.tsx` | **useCallbackの依存配列が不完全** | `handleJoinRoom`の依存配列に`isOnline`が含まれていない。古いオンライン状態で判定される可能性がある。 | `useCallback`の依存配列に`isOnline`を追加し、常に最新の状態で判定されるようにする。 |

### 優先度 C (軽微な改善・リファクタリング)

| No. | ファイル | 問題点 | 改善理由 | 修正方針 |
| :-- | :--- | :--- | :--- | :--- |
| C-1 | `src/hooks/useTodos.ts` | **「Zoom会議」タスクのハードコード** | 裏モードのトリガーとなるタスクが`useTodos`フック内に直接記述されており、変更が困難。 | 定数として別ファイルに切り出すか、環境変数で管理することで、設定の変更を容易にする。 |
| C-2 | `src/types/` | **型定義の集約** | `todo.ts`のように型がファイルごとに分散している。プロジェクトが拡大すると管理が煩雑になる。 | `src/types/index.ts`のようなファイルに主要な型定義を集約し、見通しを良くする。 |

---

## 総括

アプリケーションは仕様通りに動作していますが、特に`App.tsx`の肥大化が将来の機能追加やメンテナンスにおける大きな技術的負債となる可能性が最も高いです。優先度SおよびAの問題点を修正することで、コードの堅牢性と保守性が大幅に向上します。

次のステップとして、優先度SとAの項目についてリファクタリングを実施します。
